<!DOCTYPE html>
<html>
<head>
<style>
body {
    background-color: black;
    color: white;
}
canvas {
    border: 1px solid white;
}
#dragging-div {
    display: inline-flex;
}
#dragging-img {
    display: block;
    position: fixed;
    z-index: 1;
}
#images {
    border: 1px solid white;
    width: 120px;
}
</style>
<script type='module'>
import {buildRandomMSP} from './random.js';
import {StrokePoint, StrokeSegment} from './stroke.js';
import {$, $$, dataURItoAB, download, getCursorPosition, Point, fillCircle, intersect, strokeCircle} from './util.js';

function placeLetter(p, letter) {
    const msp = buildRandomMSP(200, 200, 20, 30);
    msp.scale(0.1);
    msp.translate(p.x+20, p.y+20);
    msp.canvas = $('#canvas');
    msp.colorize();
    msp.linewidth = 0.1;
    msp.draw();
}

window.addEventListener('load', e => {
    const images = $('#images');
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    const draggingImg = $('#dragging-img');
    let dragging = null;
    letters.split('').forEach(letter => {
        const img = new Image();
        img.src = `strokes/images/${letter}.png`;
        img.width = 40;
        images.appendChild(img);
        img.addEventListener('mousedown', e1 => {
            e1.preventDefault();
            dragging = letter;
            draggingImg.src = img.src;
            draggingImg.style.display = 'block';
            draggingImg.style.top = e1.clientY + 1 + 'px';
            draggingImg.style.left = e1.clientX + 1 + 'px';
        });
    });
    $('#canvas').addEventListener('mouseup', e1 => {
        if (!dragging) return;
        placeLetter(getCursorPosition(e1), dragging);
        console.log(dragging);
        draggingImg.style.display = 'none';
        dragging = null;
    });
    $('#dragging-div').addEventListener('mousemove', e1 => {
        if (!dragging) return;
        draggingImg.style.top = e1.clientY + 2 + 'px';
        draggingImg.style.left = e1.clientX + 2 + 'px';
    });
    $('#dragging-div').addEventListener('mouseup', e1 => {
        if (e1.target == $('#canvas')) return;
        draggingImg.style.display = 'none';
        dragging = null;
    });
    $('#dragging-div').addEventListener('mouseleave', e1 => {
        draggingImg.style.display = 'none';
        dragging = null;
    });
});
</script>
<title>Place Test</title>
</head>
<body>
<h1>Place Test</h1>
<div id='dragging-div'>
    <img id='dragging-img' width='40'>
    <canvas id='canvas' width='600' height='600'></canvas>
    <div id='images'></div>
</div>
</body>
</html>
